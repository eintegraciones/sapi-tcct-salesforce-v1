<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:salesforce="http://www.mulesoft.org/schema/mule/salesforce" xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/salesforce http://www.mulesoft.org/schema/mule/salesforce/current/mule-salesforce.xsd">
	<sub-flow name="subflow-salesforce-idfile-get" doc:id="5f0ab502-bf06-4e82-977a-8ebac636038d" >
		<set-variable value="#[attributes.uriParams.'id-file']" doc:name="id-file" doc:id="2cf641f8-ac9d-4a2a-b361-9d161f953981" variableName="id-file"/>
		<salesforce:query doc:name="Query_download_file" doc:id="f35e0dc3-6591-474c-ba15-2eff3f6c17f9" config-ref="Salesforce_Config">
			<salesforce:salesforce-query><![CDATA[SELECT FileExtension,Title,VersionData FROM ContentVersion WHERE ContentDocumentId = ':ID_DOCUMENT']]></salesforce:salesforce-query>
			<salesforce:parameters><![CDATA[#[output application/java
---
{
	ID_DOCUMENT : vars."id-file"
}]]]></salesforce:parameters>
		</salesforce:query>
		<ee:transform doc:name="Transform Message" doc:id="06339c7f-8d7e-43ee-8e0c-a491d330c126">
			<ee:message>
				<ee:set-payload><![CDATA[%dw 2.0
output application/json
---
{
  "fileName": payload[0].Title default '',
  "fileExtension": payload[0].FileExtension default '',
  "bytes": payload[0].VersionData default '',
  "type-bytes": "base64"
}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
	</sub-flow>
</mule>
